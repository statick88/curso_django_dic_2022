# M칩dulo 2: Modelos y Bases de Datos.

## Dise침o de Modelos en Django

En este diagrama, se muestra el flujo de dise침o de modelos en Django.

``` markdown

         +-----------------------+
         |                       |
         | Definir el modelo     |
         | como una clase        |
         | Python que hereda de  |
         | models.Model          |
         |                       |
         +----+-------------+----+
              |             |
              |             |
              v             v
  +-------------------+   +------------------+
  |                   |   |                  |
  | Definir campos    |   | Definir m칠todos  |
  | y atributos       |   | adicionales      |
  | del modelo        |   | del modelo       |
  |                   |   |                  |
  +--------+----------+   +------+-----------+
           |                     |
           |                     |
           v                     v
+--------------------+   +--------------------+
|                    |   |                    |
| Aplicar migraciones|   | Definir __str__    |
| para reflejar los  |   | m칠todo para        |
| cambios en la      |   | representaci칩n     |
| base de datos      |   | del modelo         |
|                    |   |                    |
+--------------------+   +--------------------+
```

## 1. Definimos el Modelo.

En Django, los modelos son la base para dise침ar la estructura de la base
de datos de nuestra aplicaci칩n web.

Cada modelo representa una tabla en la base de datos y define los campos
que estar치n presentes en dicha tabla.

Los modelos son definidos como clases Python que heredan de
models.Model, lo que permite que Django maneje autom치ticamente la
creaci칩n y gesti칩n de la base de datos.

### Creaci칩n de un Modelo.

Para crear un modelo en Django, primero definimos una clase Python que
representa la tabla en la base de datos. Por ejemplo, si deseamos crear
un modelo para representar las publicaciones en nuestro blog, podemos
definirlo de la siguiente manera:

``` python
from django.db import models

class Publicacion(models.Model):
    titulo = models.CharField(max_length=200)
    contenido = models.TextField()
    fecha_publicacion = models.DateTimeField()
```

En este ejemplo, hemos definido el modelo Publicacion con tres campos:
titulo, contenido y fecha_publicacion.

Cada campo se representa mediante un atributo de la clase, donde:
**models.CharField** representa un campo de texto, **models.TextField**
representa un campo de texto m치s largo y **models.DateTimeField**
representa una fecha y hora.

## 2. Definir M칠todos del Modelo.

Adem치s de los campos, tambi칠n podemos definir m칠todos en el modelo para
realizar acciones espec칤ficas o para dar formato a los datos. Por
ejemplo, podr칤amos agregar un m칠todo que nos devuelva una representaci칩n
m치s legible de la publicaci칩n:

``` python
from django.db import models

class Publicacion(models.Model):
    titulo = models.CharField(max_length=200)
    contenido = models.TextField()
    fecha_publicacion = models.DateTimeField()

    def __str__(self):
        return self.titulo
```

En este caso, hemos definido el m칠todo **str** que se ejecutar치 cuando
necesitemos obtener una representaci칩n de texto del objeto Publicacion.

En este caso, hemos decidido que la representaci칩n ser치 simplemente el
t칤tulo de la publicaci칩n.

Para poder probar los cambios que hemos realizado vamos a registrar
nuestro modelo en el archivo **admin.py**

``` python
#  admin.py

from .models import Publicacion

admin.site.register(Publicacion)
```

## 3. Aplicar Migraciones.

Una vez que hemos definido nuestro modelo, necesitamos aplicar las
migraciones para que los cambios se reflejen en la base de datos.

``` bash
# Ejecutar en la terminal o consola
python manage.py makemigrations
python manage.py migrate
```

Con estos pasos, hemos dise침ado nuestro modelo de Publicaciones en
Django y aplicado las migraciones para crear la tabla correspondiente en
la base de datos. Ahora estamos listos para utilizar nuestro modelo y
almacenar datos en la base de datos.

Finalmente creamos un superusuario para acceder a la administraci칩n de
nuestro proyecto.

``` bash
python manage.py createsuperuser
```

Llenamos un peque침o formulario que nos pide: nombre de usuario, correo
electr칩nico (no obligatorio), password, repeat again password.

Y listo para poder acceder a la administraci칩n de nuestro proyecto nos
dirigimos a la siguiente url <http://127.0.0.1:8000/admin>

De forma gr치fica ingresamos nuestro usuario y contrase침a creado.

![](images/ingreso_credenciales.png){fig-align="center"}

## Ejemplo de las clases Publicaci칩n y Comentario en Django:

``` python
# En el archivo models.py de la aplicaci칩n "Publicaciones"

from django.db import models

class Publicacion(models.Model):
    title = models.CharField(max_length=100)
    content = models.TextField()
    pub_date = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.title

class Comentario(models.Model):
    publicacion = models.ForeignKey(Publicacion, on_delete=models.CASCADE)
    author = models.CharField(max_length=50)
    content = models.TextField()
    pub_date = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return f"Comentario de {self.author} en {self.publicacion}"
```

En este ejemplo, hemos definido dos clases:

**La clase "Publicacion":** Representa una publicaci칩n en el blog y
tiene tres campos: **title** (t칤tulo de la publicaci칩n), **content**
(contenido de la publicaci칩n) y **pub_date** (fecha de publicaci칩n).

La fecha de publicaci칩n se establece autom치ticamente utilizando la
funci칩n **auto_now_add=True**.

Tambi칠n hemos definido un m칠todo "str" para que al imprimir una
instancia de la clase, se muestre el t칤tulo de la publicaci칩n.

**La clase "Comentario":** Representa un comentario en una publicaci칩n
de publicacion espec칤fica y tiene cuatro campos: **publicacion** (clave
externa que se relaciona con la publicacion al que pertenece el
comentario), **author** (nombre del autor del comentario), **content**
(contenido del comentario) y **pub_date** (fecha de publicaci칩n del
comentario).

Al igual que en la clase **Publicacion**, hemos definido un m칠todo "str"
para mostrar informaci칩n 칰til al imprimir una instancia de la clase.

![](images/Codigo_models_and_comentarios.png){fig-align="center"}

## Migraciones de la Base de Datos

Las migraciones en Django son una forma de gestionar los cambios en la
estructura de la base de datos de manera controlada y consistente.

Representan los cambios en la estructura de la base de datos en forma de
archivos Python y se utilizan para crear, modificar o eliminar tablas y
campos.

Cuando definimos nuestros modelos en Django (como se mostr칩 en el
ejemplo de la clase "Publicaci칩n" y "Comentario"), estamos describiendo
la estructura de nuestras tablas en la base de datos.

Sin embargo, antes de que estos modelos se puedan utilizar, Django
necesita traducirlos en el lenguaje espec칤fico del motor de base de
datos que estamos utilizando (por ejemplo, PostgreSQL, MySQL, SQLite,
etc.).

Es aqu칤 donde entran en juego las migraciones.

Cuando creamos o modificamos modelos, Django genera autom치ticamente
archivos de migraci칩n que contienen instrucciones para aplicar los
cambios necesarios en la base de datos. Cada migraci칩n representa un
paso en la evoluci칩n de la estructura de la base de datos.

**Comandos para crear y aplicar migraciones:**

``` bash
python manage.py makemigrations
```

Este comando se utiliza para crear una nueva migraci칩n a partir de los
cambios detectados en los modelos. Cuando ejecutamos este comando,
Django analiza los modelos definidos en nuestra aplicaci칩n y compara la
estructura actual con la estructura de la 칰ltima migraci칩n aplicada.

Luego, genera una nueva migraci칩n que contiene las instrucciones para
llevar la base de datos a su estado actual.

``` bash
python manage.py migrate
```

Una vez que hemos creado una o varias migraciones, utilizamos este
comando para aplicar esas migraciones pendientes y modificar la base de
datos de acuerdo con los cambios en los modelos. Django realiza las
operaciones necesarias en la base de datos para reflejar la estructura
actual de los modelos definidos en nuestra aplicaci칩n.

游눠Recuerda: "Es importante ejecutar estos comandos cada vez que
realizamos cambios en los modelos para mantener la coherencia entre la
estructura de la base de datos y la estructura definida en los modelos,
garantizando as칤 la integridad y consistencia de nuestros datos."

## Consultas a la Base de Datos con el ORM de Django.

Cuando construimos aplicaciones web, a menudo necesitamos interactuar
con una base de datos para almacenar y recuperar datos.

Django facilita esta tarea mediante su **Object-Relational Mapping
(ORM)**.

Pero, **쯈u칠 es exactamente el ORM y c칩mo podemos hacer consultas a la
base de datos utilizando esta funcionalidad?**

**Object-Relational Mapping (ORM):** Una forma amigable de interactuar
con la base de datos.

Imagina que tienes una biblioteca y quieres mantener un registro de los
libros y sus autores en una base de datos. Tradicionalmente, tendr칤as
que escribir consultas SQL para agregar, actualizar o recuperar
informaci칩n. Sin embargo, con el ORM de Django, puedes utilizar objetos
de Python para realizar estas tareas sin tener que escribir consultas
SQL directamente. 춰Es como si el ORM tradujera autom치ticamente tus
interacciones con objetos de Python a instrucciones SQL!

## Ejemplo de Consulta con el ORM de Django

Supongamos que tienes dos modelos en Django: **Publicacion** con los
campos **titulo**, **contenido** y **fecha_publicacion**, y
**Comentario** con los campos **texto** y **fecha_comentario**.

Queremos obtener todas las publicaciones que contengan comentarios y
mostrar sus t칤tulos, fechas de publicaci칩n y la cantidad de comentarios
que tienen.

``` python
from miapp.models import Publicacion, Comentario

# Realizamos una consulta utilizando el ORM de Django
publicaciones_con_comentarios = Publicacion.objects.filter(comentario__isnull=False)

# Mostramos los resultados
for publicacion in publicaciones_con_comentarios:
    cantidad_comentarios = Comentario.objects.filter(publicacion=publicacion).count()
    print(f"T칤tulo: {publicacion.titulo}, Fecha de Publicaci칩n: {publicacion.fecha_publicacion}, Comentarios: {cantidad_comentarios}")
```

En este ejemplo, la funci칩n filter(comentario\_\_isnull=False) nos
permite obtener todas las publicaciones que tienen comentarios, es
decir, filtramos aquellas publicaciones donde el campo **comentario** no
es nulo.

Luego, utilizamos un bucle for para recorrer los resultados y, para cada
publicaci칩n, realizamos una nueva consulta para contar la cantidad de
comentarios asociados a esa publicaci칩n utilizando
Comentario.objects.filter(publicacion=publicacion).count().

As칤, podemos mostrar los t칤tulos de las publicaciones, sus fechas de
publicaci칩n y la cantidad de comentarios que tienen.

## Diagrama de Consulta con ORM de Django.

``` markdown
                      +----------------+
                      |  Base de Datos |
                      +----------------+
                            |
                            v
                      +----------------+
                      |    Modelo     |
                      |  (Publicacion) |
                      +----------------+
                            |
                            v
                      +----------------+
                      |   Consulta    |
                      |   (filter)    |
                      +----------------+
                            |
                            v
                      +----------------+
                      |   Resultado   |
                      +----------------+
```

En este diagrama, el modelo **Publicacion** representa la estructura de
la tabla en la base de datos.

La consulta se realiza a trav칠s del ORM de Django, que traduce la
interacci칩n con el modelo en una consulta SQL y devuelve el resultado.

El ORM de Django nos permite realizar consultas de una manera m치s
legible y amigable, lo que facilita enormemente el manejo de datos en
nuestras aplicaciones web.

## Relaciones entre Modelos.

``` markdown

            +--------------------+          +--------------------+
            |      Publicacion   |          |        Autor       |
            +--------------------+          +--------------------+
            | - id               |          | - id               |
            | - titulo           |          | - nombre           |
            | - contenido        |          | - correo           |
            | - autor (for치nea)  |          +--------------------+
            +--------------------+
                   |
                   v
            +--------------------+
            |     Relaci칩n       |
            |   (Clave For치nea)  |
            +--------------------+
                   |
                   v
            +--------------------+
            |      Resultado     |
            +--------------------+
```

Django facilita el establecimiento de relaciones entre modelos mediante
claves for치neas y claves primarias.

Por ejemplo,

En un blog, un modelo **Publicacion** podr칤a tener una clave for치nea a
un modelo **Autor"**, lo que permitir칤a relacionar cada publicaci칩n con
su respectivo **autor**.

Adem치s, Django tambi칠n soporta diferentes tipos de relaciones como Uno a
Uno (por ejemplo, un modelo **Perfil** asociado a un modelo
**Usuario**), Uno a Muchos (por ejemplo, un modelo **Categor칤a** que
puede tener m칰ltiples publicaciones) y Muchos a Muchos (por ejemplo, una
relaci칩n de **Seguidores** entre usuarios).

Estas relaciones son fundamentales para organizar y acceder a los datos
de manera estructurada en una aplicaci칩n Django.

## Clave Primaria, Clave For치nea y Relaciones entre Modelos en Django.

En Django, los modelos representan la estructura de las tablas en la
base de datos. Cada modelo se define como una clase Python que hereda de
models.Model. Los atributos de la clase representan los campos de la
tabla, y entre ellos, destacamos las claves primarias y las claves
for치neas.

## Clave Primaria.

Ejemplo:

``` python
from django.db import models

class Autor(models.Model):
    nombre = models.CharField(max_length=100)
    pais = models.CharField(max_length=50)

    def __str__(self):
        return self.nombre
```

La clave primaria es un campo 칰nico que identifica de forma exclusiva
cada registro en una tabla.

Por defecto, Django crea autom치ticamente un campo id como clave primaria
para cada modelo, pero tambi칠n es posible definir una clave primaria
personalizada utilizando el atributo **primary_key=True**.

En este ejemplo, la tabla Autor tendr치 una clave primaria id generada
autom치ticamente. La columna id es un campo 칰nico que identificar치 de
forma 칰nica a cada autor en la base de datos.

## Clave For치nea.

Ejemplo:

``` python
from django.db import models

class Libro(models.Model):
    titulo = models.CharField(max_length=200)
    autor = models.ForeignKey(Autor, on_delete=models.CASCADE)

    def __str__(self):
        return self.titulo
```

La clave for치nea es un campo que hace referencia a la clave primaria de
otra tabla, estableciendo una relaci칩n entre ambas tablas.

Esto indica que el valor del campo de la clave for치nea en una tabla debe
coincidir con el valor de la clave primaria en la otra tabla.

En este ejemplo, el modelo Libro tiene un campo autor que es una clave
for치nea que hace referencia al modelo Autor. Cada libro est치 relacionado
con un autor espec칤fico, y la opci칩n **on_delete=models.CASCADE** indica
que si se elimina un autor, todos los libros asociados a ese autor
tambi칠n se eliminar치n autom치ticamente.

## Relaciones entre Modelos de Django:

**Relaci칩n de Uno a Muchos (OneToMany):** Un objeto de un modelo est치
relacionado con varios objetos de otro modelo.

Se logra utilizando el campo **ForeignKey**.

``` python
from django.contrib.auth.models import User
from django.db import models

class Publicacion(models.Model):
    titulo = models.CharField(max_length=100)
    contenido = models.TextField()
    autor = models.ForeignKey(User, on_delete=models.CASCADE)
```

**Relaci칩n de Muchos a Muchos (ManyToMany):** Varios objetos de un
modelo est치n relacionados con varios objetos de otro modelo. Se logra
utilizando el campo ManyToManyField.

``` python
from django.db import models

class Etiqueta(models.Model):
    nombre = models.CharField(max_length=50)

class Producto(models.Model):
    nombre = models.CharField(max_length=100)
    etiquetas = models.ManyToManyField(Etiqueta)
```

**Relaci칩n de Uno a Uno (OneToOne):** Un objeto de un modelo est치
relacionado con exactamente un objeto de otro modelo, y viceversa. Se
logra utilizando el campo OneToOneField.

``` python
from django.contrib.auth.models import User
from django.db import models

class Perfil(models.Model):
    usuario = models.OneToOneField(User, on_delete=models.CASCADE)
    fecha_nacimiento = models.DateField()
```

Estas relaciones nos permiten asociar objetos de diferentes modelos en
la base de datos, lo que es esencial para construir aplicaciones web m치s
complejas.

Django facilita el manejo de estas relaciones, lo que nos permite
desarrollar aplicaciones de forma m치s legible y amigable.

Django ofrece una potente forma de establecer relaciones entre modelos,
lo que nos permite dise침ar y construir aplicaciones web m치s complejas y
ricas en datos.

La elecci칩n del tipo de relaci칩n depender치 de la l칩gica de negocio y los
requerimientos espec칤ficos de la aplicaci칩n.

## Ejemplo de Conexi칩n del Proyecto Blog con Bases de Datos

A continuaci칩n, se presentar치 un ejemplo de configuraci칩n de Django para
conectar el proyecto de blog a tres bases de datos diferentes: SQLite,
MySQL, MongoDB y PostgreSQL.

## **SQLite**:

SQLite es una base de datos incorporada en Django por defecto. No
requiere configuraci칩n adicional para usarla, ya que Django crear치
autom치ticamente un archivo de base de datos SQLite en el directorio del
proyecto.

``` python
# En el archivo settings.py del proyecto "mi_blog"

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```

## **MySQL**:

Para conectar la base de datos de MySQL de **forma local en tu
m치quina**, necesitar치s seguir estos pasos:

1.  **Instalar MySQL Server:** Lo primero que necesitas es tener
    instalado el servidor de MySQL en tu m치quina. Puedes descargar la
    versi칩n correspondiente para tu sistema operativo desde el sitio web
    oficial de MySQL: <https://dev.mysql.com/downloads/mysql/>

2.  **Configurar el servidor:** Una vez que hayas instalado MySQL, debes
    configurar el servidor.

    Durante la instalaci칩n, se te pedir치 establecer una contrase침a para
    el usuario "root" que ser치 el administrador del servidor.

    Aseg칰rate de recordar esta contrase침a, ya que la necesitar치s m치s
    adelante.

3.  **Iniciar el servidor:** Despu칠s de instalar y configurar MySQL,
    debes iniciar el servidor.

    Esto puede variar dependiendo de tu sistema operativo, pero
    generalmente puedes hacerlo desde la l칤nea de comandos o utilizando
    un programa espec칤fico para administrar servidores de bases de
    datos.

4.  **Verificar la conexi칩n:** Una vez que el servidor est칠 en
    funcionamiento, verifica que puedas conectarte a 칠l.

    Puedes hacerlo desde la l칤nea de comandos utilizando el cliente de
    MySQL o usando una herramienta de administraci칩n como phpMyAdmin.

5.  **Crear una base de datos:** Antes de conectar Django a la base de
    datos, necesitas crear una base de datos vac칤a para tu proyecto.

    Puedes hacerlo desde el cliente de MySQL o desde una herramienta de
    administraci칩n.

6.  **Configurar Django para usar MySQL:** Ahora que tienes el servidor
    de MySQL funcionando y una base de datos creada, puedes configurar
    Django para que utilice MySQL como base de datos, puedes instalar el
    cliente de MySQL [MySQL
    Workbench](https://dev.mysql.com/downloads/workbench/).

    Ahora es necesario instalar el connector entre Django y nuestra base
    de datos, lo podemos hacer con el gestor de paquetes **pip**

``` bash
pip install mysqlclient
```

```         
Ahora vamos a configurar Django.

Para hacerlo, modifica el archivo settings.py de tu proyecto Django y ajusta la configuraci칩n de la base de datos:
```

``` python
# settings.py

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'nombre_de_la_base_de_datos',
        'USER': 'nombre_de_usuario',
        'PASSWORD': 'contrase침a_del_usuario',
        'HOST': 'localhost',
        'PORT': '3306',
    }
}
```

Aseg칰rate de reemplazar **nombre_de_la_base_de_datos**,
**nombre_de_usuario** y **contrase침a_del_usuario** con los valores
adecuados para tu configuraci칩n de MySQL.

7.  **Realizar migraciones:** Una vez configurada la base de datos en
    Django, es necesario aplicar las migraciones para crear las tablas y
    campos correspondientes. Ejecuta el siguiente comando para aplicar
    las migraciones:

``` bash
python manage.py migrate
```

8.  **Verificar la conexi칩n:** Finalmente, verifica que la conexi칩n con
    la base de datos de MySQL se haya establecido correctamente y que
    puedas realizar consultas y operaciones desde tu proyecto Django.

    Con estos pasos, tendr치s configurada la conexi칩n con la base de
    datos de MySQL en tu proyecto de Django y podr치s utilizarla para
    almacenar y recuperar datos de forma local en tu m치quina.

    |                                             |
    |---------------------------------------------|
    | ![](images/paste-1.png){fig-align="center"} |
    | ![](images/paste-2.png){fig-align="center"} |
    | ![](images/paste-3.png){fig-align="center"} |
    | ![](images/paste-4.png){fig-align="center"} |

## **PostgreSQL:**

Lo primero que necesitas es instalar PostgreSQL en tu sistema operativo.

Puedes descargar la versi칩n correspondiente para tu sistema desde el
sitio web oficial de PostgreSQL: <https://www.postgresql.org/download/>

1.  **Configurar PostgreSQL:** Durante la instalaci칩n, se te pedir치
    establecer una contrase침a para el usuario "postgres" que ser치 el
    administrador del servidor PostgreSQL. Aseg칰rate de recordar esta
    contrase침a, ya que la necesitar치s m치s adelante.

2.  **Iniciar el servidor PostgreSQL:** Despu칠s de instalar PostgreSQL,
    debes iniciar el servidor. Esto puede variar dependiendo de tu
    sistema operativo, pero generalmente puedes hacerlo desde la l칤nea
    de comandos o utilizando una herramienta espec칤fica para administrar
    servidores de bases de datos.

3.  **Verificar la conexi칩n:** Una vez que el servidor est칠 en
    funcionamiento, verifica que puedas conectarte a 칠l. Puedes hacerlo
    desde la l칤nea de comandos utilizando el cliente psql o usando una
    herramienta de administraci칩n gr치fica como pgAdmin.

4.  **Instalar el controlador de PostgreSQL para Django:** Para conectar
    Django con PostgreSQL, necesitas instalar el controlador psycopg2.
    Puedes instalarlo utilizando el gestor de paquetes pip:

    ``` bash
    pip install psycopg2 
    ```

5.  **Configurar Django para usar PostgreSQL:**

    Modifica el archivo settings.py de tu proyecto Django y ajusta la
    configuraci칩n de la base de datos:

``` python
# settings.py

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'nombre_de_la_base_de_datos',
        'USER': 'nombre_de_usuario',
        'PASSWORD': 'contrase침a_del_usuario',
        'HOST': 'localhost',  # Puedes cambiar esta direcci칩n si PostgreSQL est치 en otro equipo
        'PORT': '',          # Por defecto es el puerto 5432
    }
}
```

Aseg칰rate de reemplazar **nombre_de_la_base_de_datos**,
**nombre_de_usuario** y **contrase침a_del_usuario** con los valores
adecuados para tu configuraci칩n de PostgreSQL.

8.  **Realizar migraciones:**

    Una vez configurada la base de datos en Django, es necesario aplicar
    las migraciones para crear las tablas y campos correspondientes.
    Ejecuta el siguiente comando para aplicar las migraciones:

``` bash
python manage.py migrate 
```

2.  **Verificar la conexi칩n:**

Finalmente, verifica que la conexi칩n con PostgreSQL se haya establecido
correctamente y que puedas realizar consultas y operaciones desde tu
proyecto Django.

Con estos pasos, tendr치s configurada la conexi칩n con PostgreSQL en tu
proyecto de Django y podr치s utilizarla para almacenar y recuperar datos.

PostgreSQL es una base de datos relacional que ofrece caracter칤sticas
avanzadas y es ampliamente utilizada en aplicaciones web y proyectos de
desarrollo.

|                                              |
|----------------------------------------------|
| ![](images/paste-11.png){fig-align="center"} |
| ![](images/paste-12.png){fig-align="center"} |
| ![](images/paste-13.png){fig-align="center"} |

## **MongoDB:**

1.  Lo primero que necesitas es instalar **MongoDB** en tu sistema
    operativo. Puedes descargar la versi칩n correspondiente para tu
    sistema desde el sitio web oficial de MongoDB:
    <https://www.mongodb.com/try/download/community>

2.  **Configurar el servidor MongoDB:** Una vez que hayas instalado
    MongoDB, es necesario configurar el servidor.

    Por defecto, MongoDB se ejecuta en el puerto 27017. Aseg칰rate de que
    el servidor MongoDB est칠 en funcionamiento antes de continuar.

3.  **Instalar el controlador de MongoDB para Django:** Para conectar
    Django con MongoDB, necesitas instalar el controlador de MongoDB
    para Django, llamado "djongo". Puedes instalarlo utilizando el
    gestor de paquetes pip:

    ``` bash
    pip install djongo==1.3.1
    ```

    Para que todo funcione con normalidad, es necesario incluir el
    paquete **pymongo**, para ello se sugiere utilizar el siguiente
    comando.

    ``` bash
    pip install pymongo==3.12.1
    ```

4.  **Configurar Django para usar MongoDB:**

    Modifica el archivo settings.py de tu proyecto Django y ajusta la
    configuraci칩n de la base de datos:

``` python
 # settings.py

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'publicaciones',
    'djongo',
]

DATABASES = {
    'default': {
        'ENGINE': 'djongo',
        'NAME': 'nombre_de_la_base_de_datos',
        'CLIENT': {
            'host': 'localhost', # Cambia esta direcci칩n si tu servidor MongoDB est치 en otro equipo
            'port': 27017,       # Puerto de MongoDB (por defecto es 27017)
        },
    }
}
```

Aseg칰rate de reemplazar **nombre_de_la_base_de_datos** con el nombre que
deseas para tu base de datos MongoDB.

7.  **Realizar migraciones:**

Una vez configurada la base de datos en Django, es necesario aplicar las
migraciones para crear las colecciones y documentos correspondientes.

Ejecuta el siguiente comando para aplicar las migraciones:

``` bash
python manage.py makemigrations
python manage.py migrate 
```

2.  **Verificar la conexi칩n:**

Finalmente, verifica que la conexi칩n con MongoDB se haya establecido
correctamente y que puedas realizar consultas y operaciones desde tu
proyecto Django.

Con estos pasos, tendr치s configurada la conexi칩n con MongoDB en tu
proyecto de Django y podr치s utilizarla para almacenar y recuperar datos.

Es importante mencionar que MongoDB es una base de datos NoSQL, lo que
significa que utiliza un modelo de datos basado en documentos en lugar
de tablas y filas como las bases de datos relacionales. Esto permite una
mayor flexibilidad y escalabilidad en el almacenamiento de datos.

|                                              |
|----------------------------------------------|
| ![](images/paste-10.png){fig-align="center"} |
| ![](images/paste-11.png){fig-align="center"} |
| ![](images/paste-12.png){fig-align="center"} |
| ![](images/paste-13.png){fig-align="center"} |

# Ejemplo Pr치ctico:

## Dise침o de un Modelo de Usuarios y Publicaciones en un Blog.

### Importaci칩n de m칩dulos necesarios:

Para definir los modelos en Django, primero importamos los m칩dulos
necesarios desde la biblioteca Django.

``` python
# models.py

from django.contrib.auth.models import AbstractUser
from django.db import models
```

### Definici칩n del modelo "Usuario":

El modelo de "Usuario" se crea mediante la herencia de la clase
"AbstractUser" proporcionada por Django. Esto nos permite utilizar la
funcionalidad de autenticaci칩n y autorizaci칩n incorporada en Django.
Tambi칠n podemos agregar campos adicionales seg칰n sea necesario.

``` python
# models.py

class Usuario(AbstractUser):
    # Agrega campos adicionales si es necesario
    pass
```

En el modelo "Usuario", podemos agregar campos adicionales seg칰n las
necesidades espec칤ficas de nuestra aplicaci칩n. Al heredar de la clase
"AbstractUser" proporcionada por Django, ya contamos con campos comunes
para autenticaci칩n, como "username", "email" y "password".

Adem치s de los campos heredados, algunos ejemplos de campos adicionales
que podr칤amos agregar al modelo "Usuario" son:

**Nombre completo:** Podemos agregar un campo para almacenar el nombre
completo del usuario.

``` python
class Usuario(AbstractUser):
    # Campos heredados de AbstractUser
    ...

    # Campo adicional
    nombre_completo = models.CharField(max_length=255)
```

**Fecha de nacimiento:** Podemos incluir un campo para registrar la
fecha de nacimiento del usuario.

``` python
class Usuario(AbstractUser):
    # Campos heredados de AbstractUser
    ...

    # Campo adicional
    fecha_nacimiento = models.DateField()
```

**Biograf칤a:** Podemos permitir que los usuarios agreguen una breve
biograf칤a sobre ellos mismos.

``` python
class Usuario(AbstractUser):
    # Campos heredados de AbstractUser
    ...

    # Campo adicional
    biografia = models.TextField(blank=True, null=True)
```

**Imagen de perfil:** Podemos agregar un campo para que los usuarios
carguen una imagen de perfil.

``` python
class Usuario(AbstractUser):
    # Campos heredados de AbstractUser
    ...

    # Campo adicional
    imagen_perfil = models.ImageField(upload_to='imagenes_perfil/', blank=True, null=True)
```

Estos son solo algunos ejemplos de los campos adicionales que podr칤amos
agregar al modelo "Usuario". La elecci칩n de los campos depende de los
requisitos espec칤ficos de la aplicaci칩n y qu칠 informaci칩n adicional
deseamos almacenar para nuestros usuarios.

Django proporciona una amplia variedad de tipos de campos para adaptarse
a diferentes tipos de datos y necesidades.

### Definici칩n del modelo "Publicacion":

El modelo "Publicacion" se crea como una subclase de "models.Model".

Aqu칤 definimos los campos que representar치n los atributos de una
publicaci칩n en el blog, como "titulo", "contenido" y
"fecha_publicacion". Cada campo es una instancia de una clase de campo
de Django que define el tipo y las propiedades del campo.

``` python
# models.py

class Publicacion(models.Model):
    titulo = models.CharField(max_length=200)
    contenido = models.TextField()
    fecha_publicacion = models.DateTimeField()
```

M칠todo "str":

En el modelo "Publicacion", hemos definido el m칠todo "str" que devuelve
el t칤tulo de la publicaci칩n cuando se imprime una instancia de la clase.

Esto hace que sea m치s f치cil identificar las publicaciones en el
administrador de Django y en cualquier otra parte donde se muestren
objetos de la clase "Publicacion".

``` python
# models.py

class Publicacion(models.Model):
    # Campos de la publicaci칩n...

    def __str__(self):
        return self.titulo
```

Con estos pasos, hemos definido los modelos "Usuario" y "Publicacion" en
Django. Estos modelos representar치n las tablas "Usuario" y "Publicacion"
en la base de datos y nos permitir치n interactuar con ellos mediante el
ORM de Django.

# Actividad Pr치ctica:

## Agrega un Campo Adicional al Modelo de Publicaciones

[ ] Agrega un Campo Adicional al Modelo de Publicaciones y Realiza la
Migraci칩n Correspondiente

[ ] En el modelo de Publicaciones, agrega un nuevo campo "imagen" de
tipo "ImageField".

[ ] Crea una migraci칩n para aplicar los cambios al modelo usando el
comando

[ ] Aplica la migraci칩n a la base de datos.

## Resoluci칩n de la Actividad Pr치ctica.

**Paso 1:** Agregar un Campo Adicional al Modelo de Publicaciones

En el archivo "models.py" de la aplicaci칩n "blog", agregamos un nuevo
campo llamado "imagen" de tipo "ImageField" al modelo "Publicacion".
Esto nos permitir치 almacenar im치genes relacionadas con cada publicaci칩n.

``` python
# models.py

from django.db import models

class Publicacion(models.Model):
    titulo = models.CharField(max_length=200)
    contenido = models.TextField()
    fecha_publicacion = models.DateTimeField()
    imagen = models.ImageField(upload_to='publicaciones/', blank=True, null=True)

    def __str__(self):
        return self.titulo
```

**Paso 2:** Crear una Migraci칩n para Aplicar los Cambios

Despu칠s de agregar el nuevo campo "imagen" al modelo, necesitamos crear
una migraci칩n para aplicar los cambios a la base de datos. Django nos
proporciona un comando para generar autom치ticamente la migraci칩n.

``` bash
# Ejecutar en la terminal o consola
python manage.py makemigrations
```

**Paso 3:** Aplicar la Migraci칩n a la Base de Datos

Una vez que se ha creado la migraci칩n, la aplicamos a la base de datos
con el siguiente comando:

``` bash
# Ejecutar en la terminal o consola
python manage.py migrate
```

Con estos pasos, hemos agregado con 칠xito un campo adicional "imagen" al
modelo de Publicaciones y hemos aplicado la migraci칩n a la base de datos
para reflejar el cambio. Ahora, cada publicaci칩n en el blog tendr치 un
campo para asociar una imagen, lo que mejorar치 la experiencia visual
para los usuarios.

## Extra.

Para poder manejar el modelo de Publicaciones desde la administraci칩n de
Django, es necesario registrar el modelo en el archivo "admin.py" de la
aplicaci칩n "blog". De esta manera, podremos acceder a las publicaciones
y administrarlas desde la interfaz de administraci칩n de Django.

**Paso 4:** Registro del Modelo en el Administrador de Django

En el archivo "admin.py" de la aplicaci칩n "blog", registramos el modelo
"Publicacion" para que sea accesible desde la interfaz de
administraci칩n.

``` python
# admin.py

from django.contrib import admin
from .models import Publicacion

admin.site.register(Publicacion)
```

Con este registro, el modelo "Publicacion" estar치 disponible en la
interfaz de administraci칩n de Django.

Ahora, cuando ingreses a la URL "/admin/" en tu aplicaci칩n, podr치s
iniciar sesi칩n como superusuario y ver la secci칩n de "Publicacions",
donde podr치s agregar, editar y eliminar publicaciones desde la interfaz
de administraci칩n.

Esto facilitar치 el manejo de las publicaciones sin tener que acceder
directamente a la base de datos.

## Conclusi칩n.

Con esto, hemos completado el M칩dulo 2 de Modelos y Bases de Datos en
Django.

Has aprendido a dise침ar modelos en Django, realizar migraciones de la
base de datos, hacer consultas utilizando el ORM de Django, establecer
relaciones entre modelos y usar formularios en Django.

En el pr칩ximo m칩dulo, continuaremos explorando m치s caracter칤sticas de
Django, como vistas y plantillas.